@startuml KrossKube Metamodel

skinparam packageStyle rectangle
skinparam ArrowColor Black
skinparam defaultTextAlignment center

' ===========================
' Kubernetes Runtime (Base Layer)
' ===========================
package "Kubernetes Runtime" {
  class Deployment
  class StatefulSet
  class DaemonSet
  class CronJob
  class ReplicaSet
  class Pod
  class Container
  class Service
  class Ingress
  class Namespace
  class EnvironmentVariable

  ' Workload Controllers
  Deployment o-- ReplicaSet : manages
  StatefulSet *-- "n" Pod : manages (ordered, stable IDs)
  DaemonSet *-- "n" Pod : ensures on all nodes
  CronJob ..> Pod : schedules jobs
  CronJob --> Job : creates
  class Job

  ReplicaSet *-- "n" Pod : supervises
  Pod *-- "n" Container : contains
  Pod ..> Namespace : belongs to
  Service --> Pod : selects
  Ingress ..> Service : exposes
  Container o-- EnvironmentVariable : has
}

package "Storage" {
  class Volume
  class PersistentVolumeClaim
  class PersistentVolume
  class ExternalStorage

  Pod --> "n" Volume : mounts
  Volume --> PersistentVolumeClaim : bound to
  PersistentVolumeClaim o-- PersistentVolume : claims
  PersistentVolume ..> ExternalStorage : provisioned from
}

package "Configuration & Secrets" {
  class ConfigMap
  class Secret

  EnvironmentVariable ..> Secret : from (optional)
  EnvironmentVariable ..> ConfigMap : from (optional)
  Volume ..> Secret : mounts
  Volume ..> ConfigMap : mounts
}

package "Security (RBAC)" {
  class Role
  class RoleBinding
  class ServiceAccount

  RoleBinding --> Role : binds
  RoleBinding --> ServiceAccount : grants
  Pod ..> ServiceAccount : runs as
}

class DockerImage
DockerImage ..> Container : used by

' ===========================
' KrossKube MultiCluster Layer
' ===========================
package "KrossKube MultiCluster Abstractions" {
  
  abstract class MultiClusterResource {
    +name: String
    +clusterSelector: ClusterSelector
    +placementPolicy: PlacementPolicy
  }

  class ClusterSelector {
    +matchLabels: Map[String]
    +matchExpressions: List[Requirement]
  }

  enum PlacementPolicy {
    REPLICATED
    DISTRIBUTED
    BALANCED
  }

  ' Workload MultiCluster Resources
  abstract class MultiClusterWorkload extends MultiClusterResource

  class MultiClusterDeployment extends MultiClusterWorkload
  class MultiClusterStatefulSet extends MultiClusterWorkload  
  class MultiClusterDaemonSet extends MultiClusterWorkload
  class MultiClusterCronJob extends MultiClusterWorkload
  class MultiClusterPod extends MultiClusterWorkload

  ' Network MultiCluster Resources
  abstract class MultiClusterNetwork extends MultiClusterResource

  class MultiClusterService extends MultiClusterNetwork
  class MultiClusterIngress extends MultiClusterNetwork

  ' Storage MultiCluster Resources
  abstract class MultiClusterStorage extends MultiClusterResource

  class MultiClusterPersistentVolume extends MultiClusterStorage
  class MultiClusterPersistentVolumeClaim extends MultiClusterStorage

  ' Security MultiCluster Resources
  abstract class MultiClusterSecurity extends MultiClusterResource

  class MultiClusterRole extends MultiClusterSecurity
  class MultiClusterRoleBinding extends MultiClusterSecurity
  class MultiClusterSecret extends MultiClusterSecurity
  class MultiClusterConfigMap extends MultiClusterSecurity

  ' Composition relationships
  MultiClusterResource *-- ClusterSelector : selects clusters
  MultiClusterResource --> PlacementPolicy : defines placement
}

' ===========================
' Generation Relationships
' ===========================
MultiClusterDeployment ..> Deployment : generates CRD for
MultiClusterStatefulSet ..> StatefulSet : generates CRD for
MultiClusterDaemonSet ..> DaemonSet : generates CRD for
MultiClusterCronJob ..> CronJob : generates CRD for
MultiClusterPod ..> Pod : generates CRD for

MultiClusterService ..> Service : generates CRD for
MultiClusterIngress ..> Ingress : generates CRD for

MultiClusterPersistentVolume ..> PersistentVolume : generates CRD for
MultiClusterPersistentVolumeClaim ..> PersistentVolumeClaim : generates CRD for

MultiClusterRole ..> Role : generates CRD for
MultiClusterRoleBinding ..> RoleBinding : generates CRD for
MultiClusterSecret ..> Secret : generates CRD for
MultiClusterConfigMap ..> ConfigMap : generates CRD for


@enduml